<!--
  Version: 1.10.0-FR.3
  Last Updated: Aug 15, 2025 22:10 UTC
  Purpose:
  - Full Report page with strict list enforcement:
      * What's Working: up to 5 bullets, each 3–5 sentences
      * Needs Attention: exactly 20 unique bullets, each 4–6 sentences
  - No lead form on this page (Calendly CTA only)
  - LLM logos restored (local /img with SVG/text fallback)
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SnipeRank — Full Report</title>
  <style>
    :root{
      --max-width:760px; --pad-v:3vh; --pad-h:2rem;
      --muted:#666; --border:#e5e5e5;
      --sr-radius:16px; --sr-border:#e6e6e9; --sr-shadow:0 10px 30px rgba(0,0,0,.12);
      --sr-text:#111; --sr-muted:#5b5b66; --sr-bg:#fff; --sr-pill-bg:#fafafb; --sr-gap:16px;
    }
    *{box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;background:#fff;color:#000;margin:0;padding:var(--pad-v) var(--pad-h);max-width:var(--max-width);margin-inline:auto;display:flex;flex-direction:column;align-items:flex-start}
    h1{font-size:4rem;font-weight:700;margin:0 0 .25em 0;line-height:1;letter-spacing:-1px;background:linear-gradient(135deg,#000 0%,#3182CE 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    h2{font-size:1.6rem;font-weight:700;margin:0 0 1rem 0}
    p{font-size:1.075rem;line-height:1.65;margin:0 0 1rem 0}

    .info-row{width:100%;display:flex;gap:1rem;align-items:center;justify-content:space-between;margin:.25rem 0 1rem}
    .powered-by,.for-url{color:var(--muted);font-size:.95rem}
    .powered-by a{color:#3182CE;text-decoration:none;font-weight:600}
    .for-url strong{color:#000}

    .card{width:100%;border:1px solid var(--border);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04);background:#fff}
    .score-card{padding:1rem;margin-bottom:2.25rem}
    .score-top{display:flex;align-items:center;gap:.75rem;justify-content:space-between;flex-wrap:wrap}
    .score-main{display:flex;align-items:baseline;gap:.5rem}
    .score-number{font-size:2.25rem;font-weight:800}
    .score-band{color:var(--muted);font-size:.95rem}
    .btn-row{display:flex;gap:.5rem;align-items:center}
    .btn-ghost{border:1px solid #111;background:#fff;color:#111;padding:.55rem .9rem;border-radius:8px;cursor:pointer;font-weight:700;font-size:.95rem;transition:.2s}
    .btn-ghost:hover{background:#f2f2f2}
    .pillars{display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-top:.75rem}
    .pillar{border:1px solid var(--border);border-radius:10px;padding:.6rem .75rem;display:flex;align-items:center;justify-content:space-between;font-size:.98rem;background:#fff}
    .pillar .label{font-weight:600}
    .badge{font-weight:700;padding:.2rem .5rem;border-radius:999px;border:1px solid var(--border);font-size:.85rem;background:#fafafa}
    .highlights{margin-top:.9rem;padding-top:.9rem;border-top:1px dashed var(--border)}
    .highlights h4{margin:0 0 .55rem 0;font-size:1.2rem;font-weight:800}
    .highlights ul{margin:0;padding-left:1rem}
    .highlights li{margin:.45rem 0;line-height:1.5}

    #summary-results .section-title{font-size:1.25rem!important;font-weight:700!important;margin:2rem 0 .6rem 0!important}
    #summary-results ul{margin:0 0 1.1rem 1.1rem!important;padding-left:.2rem!important;list-style:disc!important}
    #summary-results li{line-height:1.6!important;margin:.55rem 0!important;font-size:1.02rem!important}

    .llm-insights{margin:.4rem 0 1.2rem}
    .llm-row{display:grid;grid-template-columns:auto 1fr;gap:.8rem 1rem;align-items:start;padding:.8rem 0;border-bottom:1px dashed var(--border)}
    .llm-row:last-child{border-bottom:0}
    .llm-logo{display:flex;align-items:center;justify-content:center;min-width:42px;height:32px}
    .llm-logo img{height:28px;width:auto;display:block;object-fit:contain;max-width:110px}
    .llm-fallback{display:inline-flex;align-items:center;justify-content:center;height:28px;padding:0 .75rem;border:1px solid var(--border);border-radius:6px;font-size:.85rem;font-weight:600;color:#333;background:#f8f9fa}

    .consultation-section{text-align:center;margin:2.5rem 0}
    .consultation-section .btn-primary{background:#dc3545;color:#fff;border:none;padding:.85rem 2rem;border-radius:8px;font-size:1.05rem;font-weight:600;cursor:pointer;text-decoration:none;display:inline-block}
    .consultation-note{background:#f8f9fa;padding:1rem;border-radius:8px;margin-top:1.5rem;font-size:.95rem}

    .footer{width:100%;text-align:center;padding:2rem 0 1rem;margin-top:3rem;border-top:1px solid var(--border);color:#666;font-size:.9rem}

    .sr-modal{position:fixed;inset:0;display:none;z-index:9999}
    .sr-modal[aria-hidden="false"]{display:block}
    .sr-modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.3)}
    .sr-modal__panel{position:relative;max-width:720px;width:calc(100% - 32px);margin:6vh auto;background:var(--sr-bg);color:var(--sr-text);border:1px solid var(--sr-border);border-radius:var(--sr-radius);box-shadow:var(--sr-shadow);padding:20px;max-height:90vh;overflow-y:auto}
    .sr-modal__close{position:absolute;top:10px;right:10px;border:1px solid var(--sr-border);background:#fff;border-radius:999px;width:32px;height:32px;line-height:28px;font-size:18px;cursor:pointer;text-align:center}
    .sr-modal__header h2{margin:0 0 4px;font-size:18px;font-weight:700}
    .sr-modal__sub{margin:0 0 12px;color:var(--sr-muted);font-size:14px;line-height:1.35}
    .sr-pill{background:var(--sr-pill-bg);border:1px solid var(--sr-border);border-radius:12px;padding:12px 14px;margin-bottom:var(--sr-gap)}
    .sr-pill__title{margin:0 0 6px;font-size:15px;font-weight:700}
    .sr-list{margin:0;padding-left:18px}
    .sr-list li{margin:6px 0;line-height:1.35}
    .sr-modal__fineprint{margin-top:8px;color:var(--sr-muted);font-size:12px;line-height:1.3;border-top:1px dashed var(--sr-border);padding-top:10px}

    @media(max-width:600px){.pillars{grid-template-columns:1fr}h1{font-size:3rem}}
  </style>
</head>
<body>
  <h1>SnipeRank</h1>
  <h2>AI SEO Analysis Results</h2>

  <div class="info-row">
    <div class="powered-by">Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
    <div class="for-url">Analysis for: <strong id="current-url">—</strong></div>
  </div>

  <!-- Score Card (shared) -->
  <section class="card score-card" id="scoreCard" aria-live="polite">
    <div class="score-top">
      <div class="score-main">
        <div class="score-number" id="scoreNumber">—</div>
        <div class="score-band" id="scoreBand">Calculating…</div>
      </div>
      <div class="btn-row">
        <button class="btn-ghost" type="button" data-open="sr-modal">View Scoring Methodology</button>
        <button class="btn-ghost" id="copyLLMBtn" type="button">Copy Shareable Summary</button>
      </div>
    </div>
    <div class="pillars" id="pillarsGrid"></div>
    <div class="highlights" id="highlightsBlock" hidden>
      <h4>Highlights</h4>
      <ul id="highlightsList"></ul>
    </div>
  </section>

  <!-- Backend HTML goes here -->
  <section id="summary-results">
    <p style="text-align:center;color:gray;">Loading analysis...</p>
  </section>

  <!-- Single CTA (no form on full-report) -->
  <section class="consultation-section">
    <h3>Ready to Improve Your AI Visibility?</h3>
    <p>After reviewing your analysis, book a free 30‑minute consultation to discuss your specific opportunities and next steps.</p>
    <a href="https://calendly.com/quontora" class="btn-primary" target="_blank" rel="noopener">Schedule Free Consultation</a>
    <p class="consultation-note"><strong>What we'll cover:</strong> Your AI SEO opportunities, implementation timeline, and how to get found by ChatGPT, Gemini, and other AI platforms.</p>
  </section>

  <div class="footer">© 2025 SnipeRank by <a href="https://quontora.com" target="_blank" rel="noopener" style="color:#3182CE;text-decoration:none;">quontora.com</a>. Last updated August 11.</div>

  <!-- Methodology Modal (shared) -->
  <div id="sr-modal" class="sr-modal" aria-hidden="true" role="dialog" aria-labelledby="sr-modal-title">
    <div class="sr-modal__backdrop" data-close></div>
    <div class="sr-modal__panel" role="document">
      <button class="sr-modal__close" aria-label="Close" data-close>×</button>
      <header class="sr-modal__header">
        <h2 id="sr-modal-title">SnipeRank Scoring Methodology</h2>
        <p class="sr-modal__sub">Our proprietary model evaluates four pillars (+ freshness preview). Items below are representative checks used to guide recommendations.</p>
      </header>
      <section class="sr-pill"><h3 class="sr-pill__title">AI Access Readiness</h3><ul class="sr-list"><li>robots.txt, meta directives, and sitemap crawlability.</li><li>Core Web Vitals thresholds & render stability (LCP/CLS/INP).</li><li>Internal link discoverability (click depth, orphan risk).</li></ul></section>
      <section class="sr-pill"><h3 class="sr-pill__title">Trust & Verification Signals</h3><ul class="sr-list"><li>HTTPS/SSL health and redirect hygiene.</li><li>Organization/Person schema and verifiable profiles.</li><li>Contact/footprint consistency across key surfaces.</li></ul></section>
      <section class="sr-pill"><h3 class="sr-pill__title">LLM Interpretability & Clarity</h3><ul class="sr-list"><li>Headings that ladder to one core claim.</li><li>Structured elements (lists/Q&A/tables) over dense paragraphs.</li><li>Entity disambiguation: names, dates, roles, locations.</li></ul></section>
      <section class="sr-pill"><h3 class="sr-pill__title">Prompt-Pattern Alignment</h3><ul class="sr-list"><li>Answer-first summaries and "how/compare" FAQs.</li><li>Task framing suitable for AI snippets and summaries.</li><li>Schema coverage (FAQ, Article/BlogPosting, WebSite).</li></ul></section>
      <section class="sr-pill"><h3 class="sr-pill__title">Freshness & Engagement Signals</h3><ul class="sr-list"><li>Update cadence and last‑modified headers on key pages.</li><li>Data recency and time‑boxed claims.</li><li>Interactive components and text equivalents.</li></ul></section>
      <footer class="sr-modal__fineprint">Exact weights are confidential. Scores include small variance to reflect signal confidence.</footer>
    </div>
  </div>

  <script>
    /* =========================
       LLM logos (local images)
       ========================= */
    const LOGO_SOURCES = {
      ChatGPT: ['/img/chatgpt-logo.png'],
      Claude:  ['/img/claude-logo.png'],
      Gemini:  ['/img/gemini-logo.png'],
      Copilot: ['/img/copilot-logo.png'],
      Perplexity: ['/img/perplexity-logo.png']
    };
    const ICON_SVGS = {
      ChatGPT: `<svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#10a37f"/><path d="M7 12h10M12 7v10" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>`,
      Claude: `<svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true"><rect x="3" y="3" width="18" height="18" rx="4" fill="#ff6b2c"/><path d="M7 12h10" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>`,
      Gemini: `<svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true"><circle cx="8" cy="12" r="5" fill="#1a73e8"/><circle cx="16" cy="12" r="5" fill="#4285f4" opacity="0.6"/></svg>`,
      Copilot: `<svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true"><rect x="3" y="6" width="18" height="12" rx="6" fill="#5c2d91"/><path d="M8 12h8" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>`,
      Perplexity: `<svg viewBox="0 0 24 24" width="28" height="28" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="#000"/><circle cx="12" cy="12" r="3.5" fill="#fff"/></svg>`
    };
    function logoDivFor(engine){
      const div=document.createElement('div'); div.className='llm-logo';
      const primary=(LOGO_SOURCES[engine]||[])[0];
      if(!primary){ div.innerHTML=`<span class="llm-fallback">${engine}</span>`; return div; }
      const candidates=[primary, primary.replace(/^\/+/,'')]; // '/img/x.png' -> 'img/x.png'
      const img=document.createElement('img'); img.alt=`${engine} logo`; let i=0;
      const next=()=>{ if(i<candidates.length){ img.src=candidates[i++]; } else { div.innerHTML=ICON_SVGS[engine]||`<span class="llm-fallback">${engine}</span>`; } };
      img.onerror=next; img.onload=()=>{ div.innerHTML=''; div.appendChild(img); }; next();
      return div;
    }

    /* -----------------------------------------------------------------------
       Main page logic
       --------------------------------------------------------------------- */
    document.addEventListener("DOMContentLoaded", async () => {
      // URL in header
      const urlParams = new URLSearchParams(window.location.search);
      const targetUrl = urlParams.get("url") || "https://example.com";
      document.getElementById("current-url").textContent = targetUrl;

      // Fetch backend-rendered report
      try {
        const res = await fetch(`https://sniperank-app2.onrender.com/report.html?url=${encodeURIComponent(targetUrl)}`);
        const html = await res.text();
        const host = document.getElementById("summary-results");
        host.innerHTML = html;

        // Enforce list sizes AFTER inject
        const domain = new URL(targetUrl).hostname.replace(/^www\./,'');
        enforceFullReportLists(host, domain);

        // Convert AI Engine Insights → logo+paragraph rows
        transformAIInsights(host);
      } catch (err) {
        console.error("Error loading analysis:", err);
        document.getElementById("summary-results").innerHTML =
          "<p style='text-align:center;color:red;'>Error loading analysis. Please try again.</p>";
      }

      // Fallback scorecard (kept for visual parity)
      const p = { access:18, trust:17, clarity:19, alignment:18, freshness:16 };
      renderScoreCard(p.access+p.trust+p.clarity+p.alignment+p.freshness, p, [
        "Ensure consistent schema coverage (Org, WebSite, FAQ) across key templates.",
        "Add concise FAQ aligned to 'how/compare' prompts (4–6 non‑overlapping Q&As).",
        "Reinforce org identity: bylines/authorship, About/company snippet, and a persistent contact path.",
        "Favor lists/Q&A/tables so AI can extract answers without parsing dense paragraphs."
      ]);

      // Modal controls
      document.addEventListener('click', (e) => {
        if (e.target.closest('[data-open="sr-modal"]')) document.getElementById('sr-modal').setAttribute('aria-hidden','false');
        if (e.target.matches('[data-close]')) document.getElementById('sr-modal').setAttribute('aria-hidden','true');
      });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') document.getElementById('sr-modal').setAttribute('aria-hidden','true'); });

      // Copy summary
      document.getElementById("copyLLMBtn").addEventListener("click", async () => {
        const txt = buildLLMSummary(targetUrl);
        try{ await navigator.clipboard.writeText(txt);
          const b=document.getElementById("copyLLMBtn"); const old=b.textContent; b.textContent="Copied!"; setTimeout(()=>b.textContent=old,1500);
        }catch{ window.prompt("Copy the summary:", txt); }
      });

      /* ---------------- Helpers ---------------- */
      function renderScoreCard(total, pillars, highlights){
        document.getElementById("scoreNumber").textContent = `${total}/100`;
        document.getElementById("scoreBand").textContent =
          total>=85?"Rank: Highly Visible ★★★★☆":total>=70?"Rank: Partially Visible ★★★☆☆":total>=55?"Rank: Needs Work ★★☆☆☆":"Rank: Low Visibility ★☆☆☆☆";

        const grid = document.getElementById("pillarsGrid");
        grid.innerHTML = "";
        [
          ["AI Access Readiness", pillars.access],
          ["Trust & Verification Signals", pillars.trust],
          ["LLM Interpretability & Clarity", pillars.clarity],
          ["Prompt-Pattern Alignment", pillars.alignment],
          ["Freshness & Engagement Signals", pillars.freshness],
        ].forEach(([label,val]) => {
          const d=document.createElement("div"); d.className="pillar";
          d.innerHTML = `<span class="label">${label}</span><span class="badge">${val}/20</span>`;
          grid.appendChild(d);
        });

        if (highlights?.length){
          const ul=document.getElementById("highlightsList");
          ul.innerHTML="";
          highlights.forEach(h=>{ const li=document.createElement("li"); li.textContent=h; ul.appendChild(li); });
          document.getElementById("highlightsBlock").hidden=false;
        }
      }

      function buildLLMSummary(url){
        const labels = Array.from(document.querySelectorAll('.pillar .label')).map(n=>n.textContent.trim());
        const vals = Array.from(document.querySelectorAll('.pillar .badge')).map(n=>n.textContent.trim());
        const lines = [
          `Website: ${url}`,
          `SnipeRank Score: ${document.getElementById("scoreNumber").textContent}`,
          `Pillars:`,
          ...labels.map((l,i)=>`- ${l}: ${vals[i]}`),
          ``,
          `Observed Highlights / Issues:`,
          ...Array.from(document.querySelectorAll('#highlightsList li')).map(li=>`- ${li.textContent.trim()}`),
          ``,
          `Next step — talk with Quontora:`,
          `• Book a free 30‑minute consult: https://calendly.com/quontora`,
          `• We'll deliver a tailored 30‑day plan prioritized by Technical, Content, Schema, and Freshness.`
        ];
        return lines.join("\n");
      }

      /* ====== Full Report Enforcement (Working ≤5, Needs = 20 unique, 4–6 sentences) ====== */
      function enforceFullReportLists(root, domain){
        const workingUL = findULAfterTitle(root, /what'?s\s*working/i);
        const needsUL   = findULAfterTitle(root, /needs\s*attention/i);

        if (workingUL) enforceBlock(workingUL, {mode:'cap', count:5, minS:3, maxS:5, domain, templates:makeWorkingTemplates(domain)});
        if (needsUL)   enforceBlock(needsUL,   {mode:'exact', count:20, minS:4, maxS:6, domain, templates:makeNeedsTemplates(domain)});
      }

      function findULAfterTitle(root, rx){
        const h = Array.from(root.querySelectorAll("h2,h3,h4,.section-title"))
          .find(n => rx.test((n.textContent||"").trim()));
        if (!h) return null;
        let el = h.nextElementSibling;
        while (el && el.tagName && el.tagName.toLowerCase() !== "ul") el = el.nextElementSibling;
        return el || null;
      }

      // Remove near-duplicate bodies and duplicate subjects
      function dedupeItems(ul){
        const seenSubjects = new Set();
        const seenBodies = new Set();
        Array.from(ul.querySelectorAll("li")).forEach(li => {
          const raw = (li.textContent||"").trim();
          if (!raw){ li.remove(); return; }
          const subj = (raw.split(":")[0]||raw).trim().toLowerCase();
          const body = raw.replace(/^.*?:\s*/, "").replace(/\s+/g," ").toLowerCase();
          if (seenSubjects.has(subj) || seenBodies.has(body)){
            li.remove();
          } else {
            seenSubjects.add(subj);
            seenBodies.add(body);
          }
        });
      }

      function enforceBlock(ul, {mode, count, minS, maxS, domain, templates}){
        dedupeItems(ul);

        let items = Array.from(ul.querySelectorAll("li"));
        // Normalize each existing item into <strong>Title:</strong> Body
        items.forEach(li => {
          const raw = (li.textContent||"").trim();
          const subj = (raw.split(":")[0] || raw).trim();
          const body = raw.replace(/^.*?:\s*/, "");
          const expanded = expandToRange(subj, body, minS, maxS, domain);
          li.innerHTML = `<strong>${escapeHTML(subj)}:</strong> ${escapeHTML(expanded)}`;
        });

        // Apply sizing
        if (mode === 'cap' && items.length > count){
          items.slice(count).forEach(li => li.remove());
          items = Array.from(ul.querySelectorAll("li"));
        }

        if (mode === 'exact'){
          // Backfill until we have exactly `count` items, using templates not yet present.
          const presentSubjects = new Set(items.map(li => (li.querySelector('strong')?.textContent||'').trim().toLowerCase()));
          for (const t of templates){
            if (items.length >= count) break;
            const key = t.title.toLowerCase();
            if (presentSubjects.has(key)) continue;
            const li = document.createElement("li");
            const expanded = expandToRange(t.title, t.text(domain), minS, maxS, domain);
            li.innerHTML = `<strong>${escapeHTML(t.title)}:</strong> ${escapeHTML(expanded)}`;
            ul.appendChild(li);
            items.push(li);
            presentSubjects.add(key);
          }
          // If still short, lightly vary from templates (non-duplicative)
          let idx = 0;
          const safety = 60;
          while (items.length < count && idx < safety){
            const t = templates[idx % templates.length];
            const variedTitle = t.title + (idx < 10 ? "" : ` (${(idx % 3)+2})`);
            if (!presentSubjects.has(variedTitle.toLowerCase())){
              const li = document.createElement("li");
              const variedBody = varySlightly(t.text(domain), domain);
              const expanded = expandToRange(variedTitle, variedBody, minS, maxS, domain);
              // Avoid body duplicates after variation
              const bodyKey = expanded.replace(/\s+/g,' ').toLowerCase();
              const dup = Array.from(ul.querySelectorAll('li')).some(el => (el.textContent||'').replace(/\s+/g,' ').toLowerCase().includes(bodyKey));
              if (!dup){
                li.innerHTML = `<strong>${escapeHTML(variedTitle)}:</strong> ${escapeHTML(expanded)}`;
                ul.appendChild(li);
                items.push(li);
                presentSubjects.add(variedTitle.toLowerCase());
              }
            }
            idx++;
          }
        }

        // Final pass: trim/enforce sentence count exactly in range
        Array.from(ul.querySelectorAll('li')).forEach(li => {
          const subj = (li.querySelector('strong')?.textContent||'').trim();
          const body = (li.textContent||'').replace(/^.*?:\s*/, '').trim();
          li.innerHTML = `<strong>${escapeHTML(subj)}:</strong> ${escapeHTML(trimToRange(body, minS, maxS))}`;
        });
      }

      function sentenceSplit(t){
        return (t||'').trim().split(/(?<=[.!?])\s+(?=[A-Z(0-9])/).filter(Boolean);
      }
      function trimToRange(text, minS, maxS){
        const parts = sentenceSplit(text);
        if (parts.length > maxS) return parts.slice(0, maxS).join(' ');
        if (parts.length < minS) return padSentences(parts, minS).join(' ');
        return parts.join(' ');
      }
      function expandToRange(subj, body, minS, maxS, d){
        let parts = sentenceSplit(body);
        if (parts.length >= minS) return trimToRange(body, minS, maxS);
        // Light expansion (contextual but neutral)
        const extras = [
          `This can reduce how assistants map ${d}'s entities, tasks, and answers to user prompts.`,
          `Clarifying structure and cross‑links typically improves extractability and snippet quality.`,
          `Validate improvements with a targeted crawl and structured testing on priority pages.`,
          `Document ownership and update cadence so signals remain stable over time.`,
          `Revisit after deployment to confirm reductions in ambiguity and crawl waste.`
        ];
        while (parts.length < minS && extras.length) parts.push(extras.shift());
        return trimToRange(parts.join(' '), minS, maxS);
      }
      function varySlightly(text, d){
        return text.replace(/\bur[al]?\.[a-z]+/gi, d) // swap any domain-like token with current domain
                   .replace(/\bmay\b/g, 'can')        // light synonym
                   .replace(/\bshould\b/g, 'ought to');
      }
      function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

      /* ---------------- Templates ---------------- */
      function makeWorkingTemplates(d){
        return [
          { title: "SSL Security Implementation", text: () => `${d} serves over HTTPS, establishing transport security and baseline trust with AI crawlers and search engines. This reduces downgrade risk from mixed content or redirect chains and supports inclusion in assistant‑style answers. Redirect hygiene appears stable across primary routes. Maintain this posture as you expand content and subdomains.` },
          { title: "Mobile‑Responsive Design", text: () => `Pages on ${d} render responsively, aligning with mobile‑first crawling and snippet extraction. Consistent layout cues help parsers segment content into scannable units. Preserve this by testing new templates on common device breakpoints. Avoid layout shifts that could affect Core Web Vitals and snippet stability.` },
          { title: "Content Structure Recognition", text: () => `Headings and lists on ${d} are generally parsable, which improves answer extraction. Clear section spines support entity mapping and reduce hallucination risk. Keep reinforcing list/table patterns around key tasks and FAQs. This strengthens eligibility for answer‑first summaries.` },
          { title: "Image Optimization Baseline", text: () => `A large share of images on ${d} include descriptive alt text, supporting multimodal understanding and accessibility. Continue standardizing alt patterns around core entities and actions. This makes visual references usable in assistant contexts. Periodically audit heavy images for compression.` },
          { title: "Redirect & Canonical Hygiene", text: () => `Primary redirects on ${d} look clean, lowering crawl waste and consolidation risk. Canonicals resolve to self or preferred versions. Maintain this with any CMS migrations or campaign URLs. Good consolidation helps AI engines attribute statements to the right source.` }
        ];
      }

      function makeNeedsTemplates(d){
        return [
          { title: "Schema Markup Missing",           text: () => `Entity signaling is light on ${d}. Add Organization, WebSite, and FAQ on key templates and validate at scale. Stronger markup reduces ambiguity and improves snippet inclusion. Cite dates where claims are time‑sensitive.` },
          { title: "Internal Linking Strategy",       text: () => `Connections between related pages on ${d} are inconsistent, obscuring answer paths. Build concise hubs and add descriptive anchors that mirror the user’s question. Limit deep nesting. Clear links help assistants resolve multi‑hop references.` },
          { title: "Content Depth Analysis",          text: () => `Several sections on ${d} mix promotional copy with instructions, making it harder to quote or summarize. Separate “how‑to” guidance from marketing claims and add concrete steps and examples. Depth should map to real tasks. This reduces deflection to aggregators.` },
          { title: "Site Architecture Issues",        text: () => `Overlapping sections and diffuse navigation on ${d} blur topic boundaries. Consolidate duplicate pages and elevate core categories. Use clear breadcrumbs and descriptive URLs. A coherent spine helps models map questions to definitive answers.` },
          { title: "Local SEO Signals",               text: () => `Location and service‑area cues on ${d} are faint. Add structured NAP details, hours, and regions as relevant. Align major profiles and link back to canonical pages. Strong local signals improve location‑qualified prompts.` },
          { title: "Content Freshness Gaps",          text: () => `Key pages on ${d} lack visible update cadence or last‑modified headers. Time‑boxed claims should cite dates and sources. Add lightweight changelogs on evergreen assets. Freshness helps assistants prefer your page over older references.` },
          { title: "Core Web Vitals Optimization",    text: () => `Layout stability and input delay on parts of ${d} can degrade snippet capture and render quality. Focus on LCP media, CLS from injected elements, and INP from heavy scripts. Improve first‑screen scannability for task content.` },
          { title: "Result Framing Signals",          text: () => `Several titles and meta descriptions on ${d} don’t summarize the primary answer succinctly. Tighten titles to the task and write meta descriptions that preview steps or outcomes. Clear framing increases eligibility for previews and link cards.` },
          { title: "Heading Structure",               text: () => `Some pages on ${d} jump heading levels or include multiple H1‑like spines. Normalize to one H1 with H2/H3s that ladder into steps, comparisons, or FAQs. Predictable structure improves parsing and disambiguation.` },
          { title: "Image Alt Text Coverage",         text: () => `A subset of images on ${d} lack alt attributes, creating noise for parsers. Add concise, factual alt text where images carry meaning, and mark decorative images appropriately. Keep captions aligned with entity names and actions.` },
          { title: "Mobile Interaction Friction",     text: () => `Interactive controls on ${d} sometimes interrupt reading flow or hide answers behind accordions without summaries. Provide short visible answers before toggles. Ensure tap targets are large and keyboard accessible.` },
          { title: "Robots & Sitemaps Hygiene",       text: () => `robots.txt and XML sitemaps on ${d} could better highlight canonical answer pages. List preferred URLs and remove outdated paths. Use crawl allowances reflecting your public content strategy.` },
          { title: "Canonicalization & Duplicates",   text: () => `Similar content exists at multiple URLs on ${d}, diluting signals. Consolidate to a single canonical per topic and standardize internal links to that version. Prevent UTM/filter variants from indexing.` },
          { title: "FAQ Coverage",                    text: () => `Common “how/compare” questions are missing on ${d}. Add 4–6 tightly scoped Q&As per key page, avoid overlap, keep answers short, and link to deeper sections. This maps cleanly to assistant snippets.` },
          { title: "Topic Focus Clarity",             text: () => `Several pages on ${d} try to cover multiple intents at once, weakening the primary answer. Split complex topics or isolate with H2 blocks and crisp summaries. Lead with the most common task.` },
          { title: "Internal Connection Mapping",     text: () => `Important entities on ${d} are mentioned but not consistently cross‑linked to their canonical pages. Add in‑text anchors on first mention and use consistent labels. This helps models resolve references during multi‑hop reasoning.` },
          { title: "Author & Bylines",                text: () => `Expertise indicators on ${d} are light. Add author names with roles, short bios, and a clear contact path. Include an About/company snippet stating core competency. Strong identity cues increase trust and attribution.` },
          { title: "Third‑Party Profile Consistency", text: () => `Organization details for ${d} vary across profiles/directories. Align names, categories, and links; ensure each profile points to the same canonical URL. Consistency improves verification in assistant results.` },
          { title: "Structured Data Depth",           text: () => `Beyond Org and WebSite, ${d} would benefit from Article/BlogPosting where relevant, plus FAQ and Breadcrumbs. Validate at scale and monitor warnings. Rich, clean markup provides multiple hooks for summarizers.` },
          { title: "Evidence & Citations",            text: () => `Claims on ${d} often lack inline citations or date contexts, causing assistants to prefer sources with clearer provenance. Add short citations near stats or policies and link to primary sources.` }
        ];
      }

      /* ------ AI insights: bullets → logo + paragraph ------ */
      function transformAIInsights(root){
        const title=Array.from(root.querySelectorAll('.section-title')).find(n=>/ai\s*engine\s*insights/i.test(n.textContent||'')); if(!title) return;
        let ul=title.nextElementSibling; while(ul&&ul.tagName&&ul.tagName.toLowerCase()!=='ul') ul=ul.nextElementSibling; if(!ul) return;
        const texts=Array.from(ul.querySelectorAll('li')).map(li=>li.textContent.trim()); if(!texts.length) return;
        const engines=['ChatGPT','Claude','Gemini','Copilot','Perplexity'];
        const container=document.createElement('div'); container.className='llm-insights';
        engines.forEach((engine,i)=>{ const t=texts[i]||''; if(!t) return; const row=document.createElement('div'); row.className='llm-row';
          row.appendChild(logoDivFor(engine));
          const p=document.createElement('p'); p.textContent=t; row.appendChild(p);
          container.appendChild(row); });
        ul.replaceWith(container);
      }
    });
  </script>
</body>
</html>
