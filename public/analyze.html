<!--
  Version: 1.9.7
  Last Updated: Aug 08, 2025
  Changes:
  - Replace gauge with compact score card
  - Move "Powered by" inline with H2
  - Fix "View Scoring Methodology" button
  - Redesign modal (close ×, clearer content)
  - Condense Highlights
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SnipeRank — AI SEO Analysis Results</title>
  <style>
    :root {
      --max-width: 760px;
      --pad-v: 3vh;
      --pad-h: 2rem;
      --muted: #666;
      --border: #e5e5e5;
      --blue: #2563eb;
      --red: #e11d48;
      --green: #16a34a;
      --amber: #f59e0b;
    }
    body {
      font-family: Helvetica, Arial, sans-serif;
      background: #fff;
      color: #000;
      margin: 0;
      padding: var(--pad-v) var(--pad-h);
      max-width: var(--max-width);
      margin-inline: auto;
      display: flex;
      flex-direction: column;
    }
    h1 {
      font-size: 3.25rem;
      font-weight: 800;
      margin: 0 0 .3rem 0;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg,#000 0%,#3182CE 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subhead-row{
      display:flex; align-items:center; justify-content:space-between;
      gap:1rem; flex-wrap:wrap; margin-bottom:1.25rem;
    }
    .subhead-row h2{
      font-size:1.3rem; font-weight:600; margin:0;
    }
    .powered-by{
      color:var(--muted); font-size:.95rem; margin-left:auto; white-space:nowrap;
    }
    .powered-by a{ color:#3182CE; text-decoration:none; font-weight:600; }

    /* Score Card */
    .score-card{
      width:100%;
      border:1px solid var(--border);
      border-radius:12px;
      padding:1rem;
      box-shadow:0 1px 2px rgba(0,0,0,.04);
      margin-bottom:1rem;
    }
    .score-top{
      display:flex; align-items:center; gap:1rem; justify-content:space-between; flex-wrap:wrap;
    }
    .score-main{
      display:flex; align-items:baseline; gap:.5rem;
    }
    .score-number{
      font-size:2.25rem; font-weight:800;
    }
    .score-band{ color:var(--muted); font-size:.95rem; }
    .methodology-btn{
      border:1px solid #cbd5e1; background:#f8fafc;
      padding:.55rem .9rem; border-radius:8px; cursor:pointer;
      font-weight:600; font-size:.95rem;
    }
    .methodology-btn:hover{ background:#eef2f7; }
    .pillars{
      display:grid; grid-template-columns: 1fr 1fr; gap:.75rem; margin-top:.75rem;
    }
    .pillar{
      border:1px solid var(--border); border-radius:10px; padding:.6rem .75rem;
      display:flex; align-items:center; justify-content:space-between;
      font-size:.98rem;
    }
    .pillar .label{ font-weight:600; }
    .badge{
      font-weight:700; padding:.2rem .5rem; border-radius:999px; border:1px solid var(--border);
      font-size:.85rem; background:#fafafa;
    }
    .highlights{
      margin-top:.75rem; padding-top:.75rem; border-top:1px dashed var(--border);
    }
    .highlights h4{
      margin:0 0 .4rem 0; font-size:1rem;
    }
    .highlights ul{ margin:0; padding-left:1rem; }
    .highlights li{ margin:.25rem 0; line-height:1.5; }

    /* Summary from backend */
    #summary-results{ width:100%; margin:1.25rem 0 2rem 0; }

    /* Forms / buttons */
    input, textarea {
      font-size:1.05rem; padding:.8rem 1rem; border:1px solid #000;
      width:100%; background:transparent; box-sizing:border-box;
    }
    label{ display:block; margin-bottom:.5rem; font-weight:500; }
    .form-button-wrapper{ text-align:center; margin-top:1.25rem; }
    button{
      font-size:1rem; font-weight:600; padding:.8rem 1.25rem; border:none; color:#fff;
      background: linear-gradient(135deg, #E53E3E 0%, #C53030 100%);
      cursor:pointer; border-radius:8px;
    }
    button:hover{ filter:brightness(.95); }
    .schedule-button{
      display:inline-block; background:linear-gradient(135deg, #E53E3E 0%, #C53030 100%);
      color:#fff; padding:1rem 2rem; text-decoration:none; border-radius:8px; font-weight:700;
      box-shadow:0 4px 12px rgba(229,62,62,.25);
    }
    .schedule-button:hover{ filter:brightness(.95); }

    .footer{ font-size:.85rem; color:var(--muted); margin-top:2.25rem; text-align:center; width:100%; }

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.45);
      display:none; align-items:center; justify-content:center; z-index:50;
    }
    .modal{
      width:min(600px, 92vw); background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      padding:1.1rem 1.1rem 1.1rem 1.1rem; position:relative;
    }
    .modal h3{ margin:0 0 .5rem 0; font-size:1.2rem; }
    .modal p { color:var(--muted); margin:.25rem 0 .8rem 0; line-height:1.6; }
    .modal ul{ margin:.25rem 0 0 1.1rem; }
    .modal li{ margin:.35rem 0; }
    .modal-close{
      position:absolute; top:.35rem; right:.5rem; border:none; background:transparent;
      font-size:1.6rem; line-height:1; cursor:pointer; color:#222;
    }

    /* Small screens */
    @media (max-width: 600px){
      .pillars{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <h1>SnipeRank</h1>

  <div class="subhead-row">
    <h2>AI SEO Analysis Results</h2>
    <div class="powered-by">Powered by <a href="https://quontora.com" target="_blank" rel="noopener">quontora</a></div>
  </div>

  <!-- Compact Score Card -->
  <section class="score-card" id="scoreCard" aria-live="polite">
    <div class="score-top">
      <div class="score-main">
        <div class="score-number" id="scoreNumber">—</div>
        <div class="score-band" id="scoreBand">Calculating…</div>
      </div>
      <button class="methodology-btn" id="methodologyBtn" type="button">View Scoring Methodology</button>
    </div>

    <div class="pillars" id="pillarsGrid">
      <!-- Filled by JS -->
    </div>

    <div class="highlights" id="highlightsBlock" hidden>
      <h4>Highlights</h4>
      <ul id="highlightsList"></ul>
    </div>
  </section>

  <div id="analyzed-url" style="margin:.25rem 0 .25rem 0; color:var(--muted); font-size:.95rem;">
    Analysis for: <strong id="current-url"></strong>
  </div>

  <!-- Dynamic HTML from backend -->
  <section id="summary-results"><p style="text-align:center; color:gray;">Loading analysis...</p></section>

  <!-- Full Report CTA -->
  <section class="consultation-section" style="border-top:1px solid var(--border); padding-top:1.5rem;">
    <h3>Get Your Full Report</h3>
    <form id="fullReportForm">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
        <input type="text" name="name" placeholder="Your Name" required autocomplete="name" />
        <input type="email" name="email" placeholder="Your Email" required autocomplete="email" />
        <input type="tel" name="phone" placeholder="Your Phone (optional)" autocomplete="tel" />
        <input type="text" name="company" placeholder="Your Company (optional)" autocomplete="organization" />
      </div>
      <textarea name="message" placeholder="Share context or ask a specific question — we’ll address at your free consult." rows="3" style="width:100%; margin-top:1rem;"></textarea>
      <input type="hidden" name="url" id="urlField" />
      <div class="form-button-wrapper">
        <button type="submit">Email Me My Full Report</button>
      </div>
      <p id="formMessage" style="text-align:center; font-size:.95rem; color:gray;"></p>
    </form>
  </section>

  <section class="consultation-section">
    <h3>Ready to Improve Your AI Visibility?</h3>
    <p>After reviewing your analysis, book a free 30-minute consultation to discuss your specific opportunities and next steps.</p>
    <div class="consultation-cta">
      <a href="https://calendly.com/quontora" id="scheduleBtn" class="schedule-button" target="_blank" rel="noopener">Schedule Free Consultation</a>
    </div>
    <p class="consultation-note" style="margin-top:1rem; color:var(--muted); max-width:600px; margin-inline:auto;">
      <strong>What we'll cover:</strong> Your AI SEO opportunities, implementation timeline, and how to get found by ChatGPT, Gemini, and other AI platforms.
    </p>
  </section>

  <div class="footer">&copy; 2025 SnipeRank by <a href="https://quontora.com" target="_blank" rel="noopener" style="color:#3182CE; text-decoration:none;">quontora.com</a>. Last updated August 8.</div>

  <!-- Methodology Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <button class="modal-close" id="modalClose" aria-label="Close">×</button>
      <h3 id="modalTitle">SnipeRank Scoring Methodology</h3>
      <p>Our proprietary model evaluates four pillars: AI Access Readiness, Trust & Verification, LLM Interpretability & Clarity, and Prompt‑Pattern Alignment. Example heuristics:</p>
      <ul>
        <li><strong>Semantic Obstruction Index</strong> — detects unclear domain terms & tangled headings.</li>
        <li><strong>Narrative Fit</strong> — checks if sections ladder to a single core claim.</li>
        <li><strong>Bot Clarity Ratio</strong> — favors structured elements (lists/tables/Q&A) over dense text.</li>
        <li><strong>Disambiguation Layering</strong> — encourages concise clarifiers for entities (dates, roles, locations).</li>
      </ul>
      <p style="margin-top:.6rem;">Exact weights are proprietary. Scores include a small confidence band to reflect signal variance.</p>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const targetUrl = urlParams.get("url") || "https://example.com";
      document.getElementById("current-url").textContent = targetUrl;

      // Load backend HTML summary (unchanged endpoint)
      try {
        const res = await fetch(`https://sniperank-app2.onrender.com/report.html?url=${encodeURIComponent(targetUrl)}`);
        const html = await res.text();
        document.getElementById("summary-results").innerHTML = html;
      } catch (err) {
        console.error("Error loading analysis:", err);
        document.getElementById("summary-results").innerHTML =
          "<p style='color:red; text-align:center;'>Error loading analysis</p>";
      }

      // --- V1 Scoring (frontend) ---
      const { total, pillars, highlights } = calculateScoreV1();
      renderScoreCard(total, pillars, highlights);

      // Full Report form: keep your existing flow
      const form = document.getElementById("fullReportForm");
      if (form && targetUrl) {
        document.getElementById("urlField").value = targetUrl;
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          const status = document.getElementById("formMessage");
          status.textContent = "📤 Sending...";

          const payload = {
            name: form.name.value,
            email: form.email.value,
            phone: form.phone.value,
            company: form.company.value,
            message: form.message.value,
            url: form.url.value,
          };

          try {
            const res = await fetch("https://sniperank-app2.onrender.com/api/send-link", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });
            const result = await res.json();
            if (result.success) {
              const reportUrl = `https://sniperank-app.vercel.app/full-report.html?url=${encodeURIComponent(payload.url)}`;
              window.location.href = reportUrl;
            } else {
              status.textContent = "❌ Something went wrong. Please try again.";
            }
          } catch (err) {
            console.error(err);
            status.textContent = "❌ Server error. Try again later.";
          }
        });
      }

      // Methodology modal controls
      const openBtn = document.getElementById("methodologyBtn");
      const closeBtn = document.getElementById("modalClose");
      const backdrop = document.getElementById("modalBackdrop");
      openBtn.addEventListener("click", () => { backdrop.style.display = "flex"; });
      closeBtn.addEventListener("click", () => { backdrop.style.display = "none"; });
      backdrop.addEventListener("click", (e) => { if (e.target === backdrop) backdrop.style.display = "none"; });
      document.addEventListener("keydown", (e) => { if (e.key === "Escape") backdrop.style.display = "none"; });

      // ---------- Helpers ----------
      function calculateScoreV1(){
        // Placeholder scores (deterministic range with light variance)
        const pillars = {
          access: 18 + Math.floor(Math.random() * 7),      // AI Access Readiness (18–24)
          trust: 16 + Math.floor(Math.random() * 9),       // Trust & Verification (16–24)
          clarity: 19 + Math.floor(Math.random() * 6),     // LLM Interpretability & Clarity (19–24)
          alignment: 17 + Math.floor(Math.random() * 8)    // Prompt‑Pattern Alignment (17–24)
        };
        const total = pillars.access + pillars.trust + pillars.clarity + pillars.alignment;

        // Generate three concise highlights
        const pool = [
          "Strong org identity; authorship verified.",
          "Add a concise FAQ aligned to “how/compare” prompts.",
          "Tighten headings to reinforce one core claim.",
          "Consider list/Q&A sections for AI summarization.",
          "Add entity clarifiers (dates, roles, locations).",
          "Ensure consistent schema coverage across key pages."
        ];
        const highlights = shuffle(pool).slice(0,3);
        return { total, pillars, highlights };
      }

      function renderScoreCard(total, pillars, highlights){
        document.getElementById("scoreNumber").textContent = `${total}/100`;
        document.getElementById("scoreBand").textContent = bandText(total);

        const grid = document.getElementById("pillarsGrid");
        grid.innerHTML = "";
        const items = [
          ["AI Access Readiness", pillars.access],
          ["Trust & Verification Signals", pillars.trust],
          ["LLM Interpretability & Clarity", pillars.clarity],
          ["Prompt‑Pattern Alignment", pillars.alignment],
        ];
        for (const [label, val] of items){
          const div = document.createElement("div");
          div.className = "pillar";
          div.innerHTML = `<span class="label">${label}</span><span class="badge">${val}/25</span>`;
          grid.appendChild(div);
        }

        if (highlights?.length){
          const list = document.getElementById("highlightsList");
          list.innerHTML = "";
          highlights.forEach(h => {
            const li = document.createElement("li"); li.textContent = h; list.appendChild(li);
          });
          document.getElementById("highlightsBlock").hidden = false;
        }
      }

      function bandText(score){
        if (score >= 85) return "Rank: Highly Visible ★★★★☆";
        if (score >= 70) return "Rank: Partially Visible ★★★☆☆";
        if (score >= 55) return "Rank: Needs Work ★★☆☆☆";
        return "Rank: Low Visibility ★☆☆☆☆";
      }

      function shuffle(arr){ // Fisher–Yates
        const a = arr.slice();
        for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
        return a;
      }
    });
  </script>
</body>
</html>
