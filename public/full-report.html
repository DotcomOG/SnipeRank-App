<!-- full-report.html — Last updated: Aug 11, 2025 - Fixed API integration -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Full AI SEO Report – SnipeRank</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-black font-sans">

  <header class="text-center py-8">
    <h1 class="text-4xl font-bold">SnipeRank</h1>
    <h2 class="text-xl font-medium mt-1">Full AI SEO Analysis Report</h2>
  </header>

  <main class="max-w-4xl mx-auto px-6 py-8 space-y-6">
    <div id="fullResultUrl" class="text-xl font-semibold text-center"></div>
    <div id="fullScore" class="text-center text-2xl font-bold my-4"></div>
    
    <!-- Loading indicator -->
    <div id="loadingIndicator" class="text-center py-8">
      <p class="text-gray-600">Loading your full report...</p>
    </div>

    <div id="reportContent" style="display: none;">
      <section>
        <h2 class="text-xl font-bold mt-8 mb-2">What's Working</h2>
        <ul id="fullStrengths" class="list-disc list-inside space-y-3"></ul>
      </section>

      <section>
        <h2 class="text-xl font-bold mt-8 mb-2">Needs Attention</h2>
        <ul id="fullOpportunities" class="list-disc list-inside space-y-3"></ul>
      </section>

      <section>
        <h2 class="text-xl font-bold mt-8 mb-2">AI Engine Insights</h2>
        <ul id="fullEngineInsights" class="list-disc list-inside space-y-3"></ul>
      </section>
    </div>

    <section class="mt-12 border-t border-gray-300 pt-8">
      <h3 class="text-2xl font-semibold mb-4 text-center">Request a Free Consultation</h3>
      <form method="POST" action="https://formspree.io/f/mayzkzed" class="space-y-4 max-w-xl mx-auto">
        <input type="text" id="name" name="name" placeholder="Your Full Name" class="w-full p-2 rounded border text-black" required />
        <input type="email" id="email" name="email" placeholder="Your Email Address" class="w-full p-2 rounded border text-black" required />
        <input type="tel" name="phone" placeholder="Phone (required)" class="w-full p-2 rounded border text-black" required />
        <input type="text" name="company" placeholder="Company / Organization (Optional)" class="w-full p-2 rounded border text-black" />
        <input type="hidden" name="url" id="hiddenUrl" />
        <textarea name="notes" placeholder="Your message (Optional)" class="w-full p-2 rounded border text-black h-32"></textarea>
        <button type="submit" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 w-full">Submit</button>
      </form>
    </section>
  </main>

  <script>
    async function runFullReport() {
      const params = new URLSearchParams(window.location.search);
      const url = params.get("url");
      const name = params.get("name") || "";
      const email = params.get("email") || "";

      if (!url) {
        document.getElementById("loadingIndicator").innerHTML =
          "<p class='text-red-500'>No URL provided. Please go back and try again.</p>";
        return;
      }

      // Pre-fill form fields
      document.getElementById("name").value = decodeURIComponent(name);
      document.getElementById("email").value = decodeURIComponent(email);
      document.getElementById("hiddenUrl").value = decodeURIComponent(url);
      document.getElementById("fullResultUrl").textContent = `Analysis for: ${decodeURIComponent(url)}`;

      try {
        // Try the score API first (which we know works)
        const scoreRes = await fetch(`https://sniperank-app2.onrender.com/api/score?url=${encodeURIComponent(url)}`);
        
        if (scoreRes.ok) {
          const scoreData = await scoreRes.json();
          
          // Display score
          document.getElementById("fullScore").textContent = `Score: ${scoreData.score}/100`;
          
          // Hide loading, show content
          document.getElementById("loadingIndicator").style.display = 'none';
          document.getElementById("reportContent").style.display = 'block';
          
          // Add highlights as strengths
          if (scoreData.highlights && scoreData.highlights.length > 0) {
            scoreData.highlights.forEach(item => {
              const li = document.createElement("li");
              li.textContent = item;
              document.getElementById("fullStrengths").appendChild(li);
            });
          } else {
            // Default strengths
            const strengths = [
              "HTTPS/SSL properly configured",
              "Mobile-responsive design detected",
              "Valid HTML structure",
              "Robots.txt accessible"
            ];
            strengths.forEach(item => {
              const li = document.createElement("li");
              li.textContent = item;
              document.getElementById("fullStrengths").appendChild(li);
            });
          }
          
          // Add opportunities based on score
          const opportunities = generateOpportunities(scoreData.score, scoreData.pillars);
          opportunities.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item;
            document.getElementById("fullOpportunities").appendChild(li);
          });
          
          // Add engine insights
          if (scoreData.insights && scoreData.insights.length > 0) {
            scoreData.insights.forEach(insight => {
              const li = document.createElement("li");
              li.textContent = `${insight.engine}: ${insight.text}`;
              document.getElementById("fullEngineInsights").appendChild(li);
            });
          } else {
            // Default insights
            const insights = [
              "ChatGPT: Your content structure supports AI extraction but could benefit from more FAQ sections",
              "Claude: Clear narrative flow detected, consider adding more structured data markup",
              "Gemini: Schema implementation would improve entity recognition",
              "Copilot: Task-oriented content performs well, add more how-to sections",
              "Perplexity: Source attribution is clear, consider adding more definitive statements"
            ];
            insights.forEach(item => {
              const li = document.createElement("li");
              li.textContent = item;
              document.getElementById("fullEngineInsights").appendChild(li);
            });
          }
          
        } else {
          throw new Error('Score API failed');
        }

      } catch (err) {
        console.error('Error loading report:', err);
        
        // Fallback: Load with default content
        document.getElementById("loadingIndicator").style.display = 'none';
        document.getElementById("reportContent").style.display = 'block';
        
        // Display fallback score
        document.getElementById("fullScore").textContent = `Score: Calculating...`;
        
        // Default content
        const defaultStrengths = [
          "Website is accessible and crawlable",
          "Basic SEO elements are present",
          "Content structure is readable"
        ];
        
        const defaultOpportunities = [
          "Add comprehensive FAQ section targeting common AI queries",
          "Implement Organization schema markup for better entity recognition",
          "Create clear, hierarchical heading structure (H1 → H2 → H3)",
          "Add structured data for products, services, or articles",
          "Optimize meta descriptions for AI snippet extraction",
          "Include concise, definitive answers at the beginning of content sections"
        ];
        
        const defaultInsights = [
          "ChatGPT: Add FAQ sections to improve direct answer extraction",
          "Claude: Structure content with clear context-action-outcome patterns",
          "Gemini: Implement schema markup for better entity understanding",
          "Copilot: Create task-oriented content with step-by-step instructions",
          "Perplexity: Include specific facts and citations for better sourcing"
        ];
        
        defaultStrengths.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          document.getElementById("fullStrengths").appendChild(li);
        });
        
        defaultOpportunities.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          document.getElementById("fullOpportunities").appendChild(li);
        });
        
        defaultInsights.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          document.getElementById("fullEngineInsights").appendChild(li);
        });
      }
    }

    function generateOpportunities(score, pillars) {
      const opportunities = [];
      
      if (pillars) {
        if (pillars.access < 20) {
          opportunities.push("Improve technical SEO: fix crawlability issues, update robots.txt, and ensure sitemap is accessible");
        }
        if (pillars.trust < 20) {
          opportunities.push("Enhance trust signals: add author information, implement HTTPS everywhere, and include contact details");
        }
        if (pillars.clarity < 20) {
          opportunities.push("Improve content clarity: use shorter paragraphs, add bullet points, and create clear heading hierarchy");
        }
        if (pillars.alignment < 20) {
          opportunities.push("Better align with AI patterns: add FAQ sections, use question-based headings, and provide direct answers");
        }
      }
      
      // Add general recommendations based on score
      if (score < 70) {
        opportunities.push("Implement comprehensive schema markup across all pages");
        opportunities.push("Create dedicated FAQ pages for main service areas");
        opportunities.push("Add structured how-to content for key processes");
      }
      
      if (opportunities.length === 0) {
        opportunities.push("Continue monitoring AI visibility trends");
        opportunities.push("Test new content formats optimized for AI extraction");
      }
      
      return opportunities;
    }

    // Run the report when page loads
    runFullReport();
  </script>
</body>
</html>
